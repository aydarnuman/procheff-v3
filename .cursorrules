# Cursor Rules for Procheff-v3

## Auto-completions

### Import Statements
When importing from @/lib/analysis/:
- Suggest helper functions based on context
- Auto-import types from types.ts

### Component Props
For analysis components:
- Always include dataPool prop
- Include searchTerm for searchable components
- Add onExport for exportable components

### API Patterns
```typescript
// Auto-complete this pattern for API routes:
export async function POST(request: Request) {
  try {
    const body = await request.json();
    // Validate with Zod
    // Process with AI
    // Return NextResponse
  } catch (error) {
    AILogger.error("Operation failed", { error });
    return NextResponse.json({ error }, { status: 500 });
  }
}
```

## Code Generation Rules

### React Components
Generate with:
- TypeScript interfaces
- Loading/error states
- Framer Motion animations
- Glass-card styling

### Helper Functions
Include:
- JSDoc comments
- Type safety
- Error handling
- Source tracking

## Refactoring Patterns

### Table Processing
When refactoring table code:
1. Extract to categorizeTable helper
2. Add type definitions
3. Include export functionality
4. Implement search

### Data Extraction
When extracting data:
1. Create typed extractor function
2. Include source references
3. Handle edge cases
4. Add to helpers.ts

## File Templates

### New Analysis Component
```typescript
'use client';

import { useState, useMemo } from 'react';
import { motion } from 'framer-motion';
import type { DataPool } from '@/lib/document-processor/types';

interface ComponentProps {
  dataPool: DataPool;
  searchTerm?: string;
}

export function ComponentName({ dataPool, searchTerm = '' }: ComponentProps) {
  // Implementation
}
```

### New Helper Function
```typescript
/**
 * Description of what this function does
 * @param dataPool - The data pool to process
 * @returns Processed data with source references
 */
export function helperName(dataPool: DataPool): ProcessedData[] {
  // Always include source tracking
  return data.map(item => ({
    ...item,
    source: {
      filename: doc.filename,
      page_number: entity.page_number
    }
  }));
}
```

## Quick Actions

- Convert to helper function
- Add source tracking
- Implement export
- Add loading state
- Apply glass-card styling

## Snippets

### Table Category Check
```typescript
// Check table category
if (isMenuTable(table.headers)) return 'menu';
if (isCostTable(table.headers)) return 'cost';
if (isPersonnelTable(table.headers)) return 'personnel';
if (isTechnicalTable(table.headers)) return 'technical';
return 'other';
```

### Source Reference Display
```typescript
<span className="text-xs text-slate-500">
  ðŸ“„ {source.filename}:{source.page_number}
</span>
```

### Export to CSV
```typescript
const exportToCSV = () => {
  const csv = convertToCSV(data);
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'export.csv';
  a.click();
};
```

## Linting Rules

### Enforce
- No `any` types
- Explicit return types
- Source tracking on all data
- Error handling in async functions

### Warn
- Missing loading states
- Console.log usage
- Inline styles
- Direct state mutation

## Context Awareness

### Current Architecture
- 3-Tab Analysis System (Veri Havuzu, BaÄŸlamsal, Derin)
- Source tracking (file:page) on all data
- Auto-categorization for tables
- Glassmorphism theme

### Key Patterns
- Use AILogger for logging
- Clean Claude responses with cleanClaudeJSON
- Use Zustand for state management
- Apply glass-card classes for UI

## Debugging Helpers

### Log Analysis Data
```typescript
AILogger.info("Analysis data", {
  documents: dataPool.documents.length,
  tables: dataPool.tables.length,
  entities: dataPool.entities.length
});
```

### Check Table Categories
```typescript
const categories = categorizeAllTables(dataPool.tables);
console.table({
  menu: categories.menu.length,
  cost: categories.cost.length,
  personnel: categories.personnel.length,
  technical: categories.technical.length,
  other: categories.other.length
});
```